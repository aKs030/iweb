import{g as S,c as C}from"./index-CljN-mWj.js";const f=C("TypeWriter"),N=a=>{const t=[...a];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t};class H{constructor(){this.timers=new Set,this.intervals=new Set}setTimeout(t,e){const n=setTimeout(()=>{this.timers.delete(n),t()},e);return this.timers.add(n),n}setInterval(t,e){const n=setInterval(t,e);return this.intervals.add(n),n}clearTimeout(t){clearTimeout(t),this.timers.delete(t)}clearInterval(t){clearInterval(t),this.intervals.delete(t)}clearAll(){this.timers.forEach(clearTimeout),this.intervals.forEach(clearInterval),this.timers.clear(),this.intervals.clear()}}const w={HERO_TYPING_END:"hero:typingEnd"};let d=null;function B(){if(!d)return!1;try{d.destroy()}catch{}return d=null,!0}const T=(a,t)=>Object.entries(t).forEach(([e,n])=>a.style.setProperty(e,n));function I(a){const t=document.createElement("div");t.style.cssText="position:absolute;left:-9999px;top:0;visibility:hidden;white-space:normal;pointer-events:none",document.body.appendChild(t);const e=getComputedStyle(a);["font-size","line-height","font-family","font-weight","letter-spacing","word-spacing","font-kerning","font-variant-ligatures","text-transform","text-rendering","word-break","overflow-wrap","hyphens"].forEach(s=>t.style.setProperty(s,e.getPropertyValue(s)));const n=()=>{const s=e.lineHeight.trim();if(s.endsWith("px")){const i=parseFloat(s);if(!isNaN(i))return i}const l=parseFloat(s);if(!isNaN(l)){const i=parseFloat(e.fontSize);if(!isNaN(i))return l*i}t.innerHTML='<span style="display:inline-block">A</span>';const o=t.firstChild;return(o==null?void 0:o.getBoundingClientRect().height)||0},r=s=>{t.innerHTML="";const l=s.split(" "),o=[];let i=[];const g=a.getBoundingClientRect(),u=Math.max(0,window.innerWidth-(g.left||0)-12),m=Math.min(window.innerWidth*.92,820);t.style.width=Math.max(1,Math.min(u||m,m))+"px";const h=n();return h?(l.forEach(c=>{const p=i.length?i.join(" ")+" "+c:c;t.textContent=p,t.getBoundingClientRect().height>h*1.1?i.length?(o.push(i.join(" ")),i=[c]):(o.push(c),i=[]):i.push(c)}),i.length&&o.push(i.join(" ")),o.length?o:[s]):[s]};return{getLines:r,reserveFor(s){const l=n(),i=r(s).length;return T(a,{"--lh-px":l?`${l}px`:"0px","--gap-px":l?`${l*.25}px`:"0px","--lines":String(i)}),a.setAttribute("data-lines",String(i)),i}}}class k{constructor({textEl:t,authorEl:e,quotes:n,wait:r=2400,typeSpeed:s=85,deleteSpeed:l=40,shuffle:o=!0,loop:i=!0,onBeforeType:g=null}){if(!t||!e||!(n!=null&&n.length)){f.error("TypeWriter: Missing required parameters");return}if(this.quotes=n.filter(u=>u==null?void 0:u.text),!this.quotes.length){f.error("No valid quotes");return}if(this.textEl=t,this.authorEl=e,this.wait=r,this.typeSpeed=s,this.deleteSpeed=l,this.shuffle=o,this.loop=i,this.onBeforeType=g||null,this.timerManager=new H,this._isDeleting=!1,this._txt="",this._queue=this._createQueue(),this._index=this._queue.shift()??0,this._current=this.quotes[this._index],document.body.classList.add("has-typingjs"),this.onBeforeType){const u=this.onBeforeType(this._current.text);typeof u=="string"&&(this._current.text=u)}this._tick()}destroy(){if(this.timerManager){this.timerManager.clearAll(),document.body.classList.remove("has-typingjs");try{d===this&&(d=null)}catch{}}}_createQueue(){return this.quotes?this.shuffle?N([...Array(this.quotes.length).keys()]):[...Array(this.quotes.length).keys()]:[]}_nextQuote(){if(!this._queue||!this.quotes)return null;if(!this._queue.length){if(!this.loop)return null;this._queue=this._generateQueue()}return this._index=this._queue.shift()??0,this._current=this.quotes[this._index]}_generateQueue(){return!this.quotes||this.quotes.length<=1?[0]:this._createQueue()}_renderText(t){if(!this.textEl)return;const e=t.includes(`
`)?t.split(`
`):[t];this.textEl.innerHTML="",e.forEach(n=>{const r=document.createElement("span");r.textContent=n,r.className="typed-line",this.textEl.appendChild(r)})}_tick(){var r;if(!((r=this._current)!=null&&r.text)||!this.timerManager)return this._handleQuoteTransition();const t=String(this._current.text),e=String(this._current.author??"");this._txt=this._isDeleting?t.substring(0,Math.max(0,this._txt.length-1)):t.substring(0,this._txt.length+1),this._renderText(this._txt),this.authorEl&&(this.authorEl.textContent=e);let n=this._isDeleting?this.deleteSpeed:this.typeSpeed;if(!this._isDeleting&&this._txt.length&&(n+={",":120,".":300,"…":400,"!":250,"?":250,";":180,":":180,"—":220,"–":180}[this._txt.slice(-1)]||0),!this._isDeleting&&this._txt===t){try{document.dispatchEvent(new CustomEvent(w.HERO_TYPING_END,{detail:{text:t,author:e}}))}catch(s){f.warn("TypeWriter: dispatch hero:typingEnd failed",s)}n=this.wait??2400,this._isDeleting=!0}else if(this._isDeleting&&!this._txt){const s=this._handleQuoteTransition();if(s===null)return;n=s}this.timerManager&&this.timerManager.setTimeout(()=>this._tick(),n)}_handleQuoteTransition(){this._isDeleting=!1;const t=this._nextQuote();if(!t)return this.destroy(),null;if(this.onBeforeType){const e=this.onBeforeType(t.text);typeof e=="string"&&(t.text=e)}return 600}}async function F(a={}){var t,e,n;try{const r=document.querySelector(".typewriter-title"),s=S("typedText"),l=S("typedAuthor");if(!r||!s||!l)return!1;let o=null;try{o=await(await fetch("/content/config/typewriter-quotes.json")).json()}catch{o=null}if(!(o!=null&&o.length))return!1;let i={};if((t=a.heroDataModule)!=null&&t.typewriterConfig)i=a.heroDataModule.typewriterConfig;else if(a.ensureHeroDataModule)try{i=((e=await a.ensureHeroDataModule())==null?void 0:e.typewriterConfig)||{}}catch(h){f.warn("TypeWriter: ensureHeroDataModule failed",h)}const g=I(r),u=h=>{try{h.style.removeProperty("bottom");const c=h.getBoundingClientRect(),p=document.querySelector("#site-footer");if(!p)return;const _=p.getBoundingClientRect(),y=Math.max(0,c.bottom-(_.top-24));if(y>0){const v=document.body.classList.contains("footer-expanded")?"clamp(8px,1.5vw,16px)":h.classList.contains("typewriter-title--fixed")?"clamp(16px,2.5vw,32px)":"clamp(12px,2vw,24px)";T(h,{bottom:`calc(${v} + ${y}px)`})}}catch(c){f.warn("TypeWriter: checkFooterOverlap failed",c)}},m=()=>{const h=new k({textEl:s,authorEl:l,quotes:o,wait:2400,typeSpeed:85,deleteSpeed:40,shuffle:!0,loop:!0,...i,onBeforeType:x=>{r.classList.add("is-locked");const L=g.getLines(x).join(`
`),E=g.reserveFor(x),M=getComputedStyle(r),b=parseFloat(M.getPropertyValue("--lh-px"))||0,D=parseFloat(M.getPropertyValue("--gap-px"))||0;return T(r,{"--box-h":`${Math.max(0,E*b+(E-1)*D)}px`}),r&&requestAnimationFrame(()=>u(r)),L}}),c=()=>{try{r.classList.remove("is-locked")}catch(x){f.warn("TypeWriter: remove lock failed",x)}};document.addEventListener(w.HERO_TYPING_END,c);const p=()=>{r&&u(r)};p();const _=setInterval(p,100);setTimeout(()=>clearInterval(_),2e3),document.addEventListener("footer:loaded",p,{once:!0});const y=()=>{r&&requestAnimationFrame(p)};window.addEventListener("resize",y,{passive:!0}),d=h;const v=d;v.__teardown=()=>{document.removeEventListener(w.HERO_TYPING_END,c),window.removeEventListener("resize",y)}};return await(((n=document.fonts)==null?void 0:n.ready)??Promise.resolve()),m(),d}catch(r){return f.error("Init failed",r),!1}}export{k as TypeWriter,F as initHeroSubtitle,B as stopHeroSubtitle};
