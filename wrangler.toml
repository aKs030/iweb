#:schema node_modules/wrangler/config-schema.json

# ============================================================================
# Main Worker: AI Search & Groq Proxy (Free AI Inference)
# ============================================================================
name = "ai-search-proxy"
main = "workers/ai-search-proxy/index.js"
compatibility_date = "2025-01-23"
compatibility_flags = ["nodejs_compat"]

# Route both www and apex domain for /api/search and /api/gemini
# Note: /api/gemini endpoint name kept for backward compatibility, but now uses Groq
routes = [
  { pattern = "www.abdulkerimsesli.de/api/search", zone_name = "abdulkerimsesli.de" },
  { pattern = "abdulkerimsesli.de/api/search", zone_name = "abdulkerimsesli.de" },
  { pattern = "www.abdulkerimsesli.de/api/gemini", zone_name = "abdulkerimsesli.de" },
  { pattern = "abdulkerimsesli.de/api/gemini", zone_name = "abdulkerimsesli.de" }
]

[vars]
RAG_ID = "throbbing-mode-6fe1"
# Cache TTL in seconds (default: 1 hour)
CACHE_TTL = "3600"
# Max search results to return
MAX_SEARCH_RESULTS = "10"
# AI Model (Groq)
AI_MODEL = "llama-3.3-70b-versatile"

[triggers]
# Daily cache refresh at 3 AM UTC
crons = ["0 3 * * *"]

# ============================================================================
# Deployment & Secrets
# ============================================================================
# Deploy: wrangler deploy
# Secrets: wrangler secret put GROQ_API_KEY
# Get free API key at: https://console.groq.com/keys

# ============================================================================
# YouTube API Proxy Worker
# ============================================================================
[env.youtube]
name = "youtube-api-proxy"
main = "workers/youtube-api-proxy/index.js"
compatibility_date = "2025-01-23"

# Route both www and apex domain for /api/youtube/*
routes = [
  { pattern = "www.abdulkerimsesli.de/api/youtube/*", zone_name = "abdulkerimsesli.de" },
  { pattern = "abdulkerimsesli.de/api/youtube/*", zone_name = "abdulkerimsesli.de" }
]

[env.youtube.vars]
# Cache TTL in seconds (default: 1 hour)
CACHE_TTL = "3600"
# Rate limit: max requests per minute per IP
RATE_LIMIT_PER_MINUTE = "60"

# ============================================================================
# Deployment & Secrets
# ============================================================================
# Deploy: wrangler deploy --env youtube
# Secrets: wrangler secret put YOUTUBE_API_KEY --env youtube