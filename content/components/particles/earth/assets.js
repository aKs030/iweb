import{CONFIG as a}from"./config.js";import{createLogger as y}from"../../../utils/shared-utilities.js";const u=y("EarthAssets");async function w(e,l,E,M,T){const r=T||new e.LoadingManager,n=new e.TextureLoader(r);let s,o,i,t;try{[s,o,i,t]=await Promise.all([n.loadAsync(a.PATHS.TEXTURES.DAY),n.loadAsync(a.PATHS.TEXTURES.NIGHT),n.loadAsync(a.PATHS.TEXTURES.NORMAL),n.loadAsync(a.PATHS.TEXTURES.BUMP)])}catch(c){throw u.error("Texture loading failed:",c),new Error("Texture loading failed: "+(c?.message||String(c)))}const d=E.capabilities.getMaxAnisotropy();[s,o,i,t].forEach(c=>{c&&(c.anisotropy=Math.min(d,M?4:16))});const p=new e.MeshStandardMaterial({map:s,normalMap:i,bumpMap:t,bumpScale:a.EARTH.BUMP_SCALE,roughness:.7,metalness:0}),A=new e.MeshStandardMaterial({map:s,normalMap:i,bumpMap:t,bumpScale:a.EARTH.BUMP_SCALE,roughness:.7,metalness:0,emissive:16764006,emissiveMap:o,emissiveIntensity:a.EARTH.EMISSIVE_INTENSITY*4}),m=M?a.EARTH.SEGMENTS_MOBILE:a.EARTH.SEGMENTS,h=new e.SphereGeometry(a.EARTH.RADIUS,m,m),S=new e.Mesh(h,p);return S.position.set(0,-6,0),S.scale.set(1.5,1.5,1.5),S.userData.currentMode="day",S.userData.targetPosition=new e.Vector3(0,-6,0),S.userData.targetScale=1.5,S.userData.targetRotation=0,l.add(S),{earthMesh:S,dayMaterial:p,nightMaterial:A}}async function O(e,l,E,M,T){const r=new e.TextureLoader(T),[n,s]=await Promise.all([r.loadAsync(a.PATHS.TEXTURES.MOON).catch(()=>null),r.loadAsync(a.PATHS.TEXTURES.MOON_BUMP).catch(()=>null)]),o=E.capabilities.getMaxAnisotropy();n&&(n.anisotropy=Math.min(o,M?4:16)),s&&(s.anisotropy=Math.min(o,M?4:16));const i=new e.MeshStandardMaterial({map:n,bumpMap:s,bumpScale:a.MOON.BUMP_SCALE,roughness:.9,metalness:0,color:n?16777215:11184810}),t=new e.LOD,d=new e.SphereGeometry(a.MOON.RADIUS,a.MOON.SEGMENTS,a.MOON.SEGMENTS);t.addLevel(new e.Mesh(d,i),0);const p=new e.SphereGeometry(a.MOON.RADIUS,28,28);t.addLevel(new e.Mesh(p,i),15);const A=new e.SphereGeometry(a.MOON.RADIUS,16,16);return t.addLevel(new e.Mesh(A,i),40),t.position.set(a.MOON.DISTANCE,2,-10),t.userData.targetPosition=new e.Vector3(a.MOON.DISTANCE,2,-10),t.userData.targetScale=1,l.add(t),t}async function N(e,l,E,M){const T=new e.TextureLoader(E);try{const r=await T.loadAsync(a.PATHS.TEXTURES.CLOUDS);r.wrapS=e.RepeatWrapping,r.wrapT=e.RepeatWrapping,r.anisotropy=l.capabilities.getMaxAnisotropy();const n=new e.MeshStandardMaterial({map:r,transparent:!0,opacity:a.CLOUDS.OPACITY,blending:e.NormalBlending,depthWrite:!1,side:e.DoubleSide}),s=M?a.EARTH.SEGMENTS_MOBILE:a.EARTH.SEGMENTS,o=new e.SphereGeometry(a.EARTH.RADIUS+a.CLOUDS.ALTITUDE,s,s);return new e.Mesh(o,n)}catch(r){return u.warn("Cloud texture failed to load:",r),new e.Object3D}}export{N as createCloudLayer,w as createEarthSystem,O as createMoonSystem};
