import{CONFIG as r}from"./config.js";import{createLogger as g,TimerManager as E}from"../../../utils/shared-utilities.js";const M=g("EarthCamera"),A=new E;class O{constructor(t,a){this.THREE=t,this.camera=a,this.cameraTarget={x:0,y:0,z:10},this.cameraPosition={x:0,y:0,z:10},this.mouseState={zoom:10},this.cameraOrbitAngle=0,this.targetOrbitAngle=0,this.cameraTransition=null}setupCameraSystem(){this.updateCameraForSection("hero")}updateCameraForSection(t){const a=t==="site-footer"?"contact":t==="section3"?"about":t;r.CAMERA.PRESETS[a]?this.flyToPreset(a):(M.warn(`No preset for '${t}', using hero`),this.flyToPreset("hero"))}flyToPreset(t){const a=r.CAMERA.PRESETS[t];if(!a)return;this.cameraTransition&&(A.clearTimeout(this.cameraTransition),this.cameraTransition=null);const i={...this.cameraTarget},o=this.mouseState.zoom,s=this.camera.userData.currentLookAt||new this.THREE.Vector3(0,0,0),n=new this.THREE.Vector3(a.lookAt.x,a.lookAt.y,a.lookAt.z),m=r.CAMERA.TRANSITION_DURATION*1e3,l=performance.now(),c=()=>{const u=performance.now()-l,e=Math.min(u/m,1),h=e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2;if(this.cameraTarget.x=i.x+(a.x-i.x)*h,this.cameraTarget.y=i.y+(a.y-i.y)*h,this.mouseState.zoom=o+(a.z-o)*h,this.camera){const T=new this.THREE.Vector3().lerpVectors(s,n,h);this.camera.lookAt(T),this.camera.userData.currentLookAt=T.clone()}e<1?this.cameraTransition=A.setTimeout(c,16):(this.cameraTransition=null,this.camera&&(this.camera.userData.currentLookAt=n.clone()))};c()}updateCameraPosition(){const t=r.CAMERA.LERP_FACTOR,a=this.targetOrbitAngle-this.cameraOrbitAngle,i=Math.min(Math.abs(a)/Math.PI,1),o=.06+(1-Math.pow(1-i,4))*.12;this.cameraOrbitAngle+=a*o;const s=this.mouseState.zoom,n=this.cameraTarget.x+Math.sin(this.cameraOrbitAngle)*s*.75,m=this.cameraTarget.y,l=Math.cos(this.cameraOrbitAngle)*s;this.cameraPosition.x+=(n-this.cameraPosition.x)*t,this.cameraPosition.y+=(m-this.cameraPosition.y)*t,this.cameraPosition.z+=(l-this.cameraPosition.z)*t,this.camera.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z);const c=this.camera.userData.currentLookAt||new this.THREE.Vector3(0,0,0);this.camera.lookAt(c)}handleWheel(t){this.mouseState.zoom-=t.deltaY*.01,this.mouseState.zoom=Math.max(r.CAMERA.ZOOM_MIN,Math.min(r.CAMERA.ZOOM_MAX,this.mouseState.zoom))}setTargetOrbitAngle(t){this.targetOrbitAngle=t}cleanup(){A.clearAll(),this.cameraTransition&&(clearTimeout(this.cameraTransition),this.cameraTransition=null)}}export{O as CameraManager};
